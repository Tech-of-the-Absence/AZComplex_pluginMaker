# AZComplex Plugin API

Добро пожаловать в систему плагинов AZComplex. Эта система позволяет расширять функциональность основного приложения за счёт добавления **пользовательских элементов**.

Каждый плагин может регистрировать следующие компоненты:

| Компонент       | Регистрируется через |
| --------------- | -------------------- |
| **Действие**    | `ActionType`         |
| **Наблюдатель** | `WatcherType`        |
| **Координатор** | `CoordinatorType`    |
| **Композитор**  | `ComposerType`       |

---

## Метод инициализации плагина

В корне плагина должен находиться класс `Main` со статическим методом

```java
public static void init(EditorContext context,
                        String folder,
                        ExternalContext external)
```

Метод вызывается загрузчиком при подключении плагина и служит точкой входа. Внутри `init()` можно подписаться на события через `external.addAZListener(...)`, подготовить ресурсы и выполнить первоначальную настройку.

---

## Регистрация компонента

1. Каждый класс‑компонент (действие, наблюдатель, координатор, композитор) должен быть помечен аннотацией `@PluginComponent`. Загрузчик сканирует класс‑путь и автоматически регистрирует все такие классы.
2. Для добавления ОС-зависимой реализации на C++ (возможно только для команд и провайдеров) необходимо включить:

   * числовой код типа,
   * и базовое имя компонента (без суффикса `Action` / `Watcher` / `Coordinator` / `Composer`),

   ...в файл `methods.list`. Возможные коды:

   | Код | Тип                       |
   | --- | ------------------------- |
   | 1   | Действие                  |
   | 2   | Наблюдатель               |
   | 3   | Координатор               |
   | 4   | Композитор                |
   | 5   | Инициализатор наблюдателя |

---

## Правила именования

Имена классов‑компонентов завершаются на один из суффиксов: `Action`, `Watcher`, `Coordinator`, `Composer`. Метод `name()` (реализован по умолчанию в интерфейсах) отбрасывает этот суффикс и возвращает базовое имя, например: `TeleportAction` → `Teleport`.

---

## Интерфейс `ActionType`

| Метод                                                | Описание                                                                                                                                              |
| ---------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Consumer<ITaskExecutor> getAction(ActionCommand c)` | Возвращает действие как `Consumer`, исполняемый с помощью `ITaskExecutor`. Значения свойств по умолчанию задаются в виде `Map<String, Serializable>`. |
| `default String name()`                              | Имя без суффикса `Action`.                                                                                                                            |

## Интерфейс `WatcherType`

| Метод                                                                | Описание                                      |
| -------------------------------------------------------------------- | --------------------------------------------- |
| `Predicate<ITaskExecutor> getWatcher(WatcherCommand c)`              | Предикат‑условие для команды.                 |
| `default void init(ITaskExecutor f, WatcherCommand c, int x, int y)` | Сбрасывает состояние наблюдателя к исходному. |
| `default String name()`                                              | Имя без суффикса `Watcher`.                   |

## Интерфейс `CoordinatorType`

| Метод                                                                        | Описание                                                                                                     |
| ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| `DynamicSupplier<Point> getCoordinator(ITaskExecutor f, Coordinator c)`      | Поставщик координат; может реализовать `init()`.                                                             |
| `void paint(Graphics2D g2, Coordinator c, int x, int y, Dimension size)`     | Отрисовывает квадрат — графическое представление координатора.                                               |
| `default void paintTrack(Graphics2D g2, int x, int y, int s, Coordinator c)` | Отображает направляющий эффект при наведении, например, пунктирную линию, показывающую направление движения. |
| `ArrayList<Serializable> getDefaultProperties(int x, int y)`                 | Значения свойств по умолчанию.                                                                               |
| `default String name()`                                                      | Имя без суффикса `Coordinator`.                                                                              |

## Интерфейс `ComposerType`

| Метод                                                                            | Описание                                                                   |
| -------------------------------------------------------------------------------- | -------------------------------------------------------------------------- |
| `DynamicSupplier<String> getComposer(ITaskExecutor f, Composer c)`               | Поставщик строки‑результата.                                               |
| `void paint(Graphics2D g2, Composer c, int x, int y, Dimension size, Polygon p)` | Отрисовывает восьмиугольник (`p`) — графическое представление композитора. |
| `boolean isFlatBased()`                                                          | Возвращает, основан ли композитор на плоской схеме.                        |
| `ArrayList<Serializable> getDefaultProperties(String s)`                         | Значения свойств по умолчанию.                                             |
| `default String name()`                                                          | Имя без суффикса `Composer`.                                               |

---

## Формы компонентов при отрисовке

Формы ниже представляют собой рекомендованные визуальные обозначения:

* **Действия** — круги
* **Наблюдатели** — скруглённые прямоугольники
* **Координаторы** — квадраты
* **Композиторы** — восьмиугольники (многоугольник `p` — их форма)
